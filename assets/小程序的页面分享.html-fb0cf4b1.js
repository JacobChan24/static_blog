import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as e,f as s}from"./app-9e438faa.js";const p={},t=s(`<p>https://juejin.cn/post/6844903635772506119</p><h2 id="api层面" tabindex="-1"><a class="header-anchor" href="#api层面" aria-hidden="true">#</a> API层面</h2><h3 id="onshareappmessage" tabindex="-1"><a class="header-anchor" href="#onshareappmessage" aria-hidden="true">#</a> onShareAppMessage</h3><p>小程序如果想对外分享，必须在<code>page</code>里面定义<code>onShareAppMessage</code>函数，来配置页面分享转发相关的信息。</p><ul><li>只有定义了此事件处理函数，右上角菜单才会显示 “转发” 按钮</li><li>用户点击转发按钮的时候会调用</li><li>此事件需要 return 一个 Object，用于自定义转发内容</li></ul><p>一个页面可能会有多个分享，可以由插入的参数options来判断具体是由哪个位置进行分享，从而做不同的逻辑判断。</p><p>return对象的返回函数：</p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/10/16482019db9ae7d7~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>如果定义了该事件，又不想通过页面menu转发，可以通过<code>hideShareMenu来隐藏掉</code></strong></p><p>注意事项：</p><ul><li>转发后不添加imageUrl的话，将截图作为转发的默认图片。</li><li>from 字段可以通过在转发成功后调取的 success、complete 来进行对 menu 和 button 的不同操作</li><li>如果有携带 shareTicket 值，会在 success 回调产生，返回结果在 shareTickets 字段中，是一个数组，可以做一定处理</li></ul><h3 id="wx-showsharemenu" tabindex="-1"><a class="header-anchor" href="#wx-showsharemenu" aria-hidden="true">#</a> wx.showShareMenu</h3><p>一般是用来配置相关的参数，常见的如<code>withShareTicket</code>，用它来获取群信息，群的相关标示。</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>wx<span class="token operator">.</span><span class="token function">showShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  withShareTicket<span class="token punctuation">:</span> <span class="token constant boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
复制代码
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="wx-hidesharemenu" tabindex="-1"><a class="header-anchor" href="#wx-hidesharemenu" aria-hidden="true">#</a> wx.hideShareMenu</h3><p>隐藏menu级别的转发功能，但是button中还存在着转发。</p><p>如果先设置 showShareMenu ，并且配置了 withShareTicket，再用 hideShareMenu 方法，通过按钮转发，照样能获取 shareTicket，如下：</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>wx<span class="token operator">.</span><span class="token function">showShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  withShareTicket<span class="token punctuation">:</span> <span class="token constant boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
wx<span class="token operator">.</span><span class="token function">hideShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
复制代码
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="wx-updatesharemenu" tabindex="-1"><a class="header-anchor" href="#wx-updatesharemenu" aria-hidden="true">#</a> wx.updateShareMenu</h3><p>更新shareMenu信息需要用update操作哦，这里需要注意下，一般都是会更新<code>withShareTicket</code>属性。</p><h3 id="wx-getshareinfo" tabindex="-1"><a class="header-anchor" href="#wx-getshareinfo" aria-hidden="true">#</a> wx.getShareInfo</h3><p>在拿到了shareTicket信息后，可以由此API获取转发详细信息</p><div class="language-php line-numbers-mode" data-ext="php"><pre class="language-php"><code>wx<span class="token operator">.</span><span class="token function">getShareInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    shareTicket<span class="token punctuation">:</span> res<span class="token operator">.</span>shareTickets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token argument-name">success</span><span class="token punctuation">:</span> <span class="token operator">...</span>
    fail<span class="token punctuation">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
复制代码
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相关回调的参数</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token punctuation">{</span>
    <span class="token property">errMsg</span><span class="token punctuation">:</span> <span class="token string">&quot;getShareInfo:ok&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">iv</span><span class="token punctuation">:</span> <span class="token string">&quot;gRHeFU+Nhr36RmladCXnRQ==&quot;</span><span class="token punctuation">,</span> 
    <span class="token property">encryptedData</span><span class="token punctuation">:</span> <span class="token string">&quot;IQ/RwZLeQFUGuxv0bBfOrL/KLnXO+bxcyCBru5lB92FkHIg8ae…7TnHwU+rqgerFKvpvS5JbFyh+9liUqyb2bk6/LETYQ+h/FQ==&quot;</span>
<span class="token punctuation">}</span>
复制代码
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由iv和encryptedData进行解密，可以拿到openGId的值。为当前群对当前小程序的唯一值。额外还可以拿到群名称等更多的开放数据。</p><h3 id="button转发" tabindex="-1"><a class="header-anchor" href="#button转发" aria-hidden="true">#</a> button转发</h3><p>页面内需要转发时，需要给<code>button</code>组件设置<code>open-type=&quot;share&quot;</code>，并在触发的地方判断来源。</p><h2 id="获取分享链接流程" tabindex="-1"><a class="header-anchor" href="#获取分享链接流程" aria-hidden="true">#</a> 获取分享链接流程</h2><p>在小程序中，获取openGId主要有两种途径，也一般围绕着两种途径做分享相关的开发：</p><ul><li>当用户打开<code>withShareTicket</code>的卡片时，可以在onLauch或者<code>getShareInfo</code>中获取加密信息，并且传给服务端获得openGId。</li><li>当用户分享成功后，会在回调里收到一个<code>shareTicket</code>，然后通过<code>getShareInfo</code>来获得加密信息，获得openGId。</li></ul><h2 id="拓展玩法" tabindex="-1"><a class="header-anchor" href="#拓展玩法" aria-hidden="true">#</a> 拓展玩法</h2><h3 id="app分享到小程序" tabindex="-1"><a class="header-anchor" href="#app分享到小程序" aria-hidden="true">#</a> APP分享到小程序</h3><p>传统APP要以小程序卡片的形式分享到微信，需要满足以下几个条件：</p><ul><li><p>要求发起分享的App与小程序属于同一微信开放平台帐号；</p></li><li><p>支持分享小程序类型消息至好友会话，不支持“分享至朋友圈” “收藏”；</p></li><li><p>微信客户端版本要求：6.5.6及以上微信客户端版本，若客户端版本低于6.5.6，小程序类型分享将自动转成网页类型分享。开发者必须填写网页链接字段，确保低版本客户端能正常打开网页链接；</p></li><li><p>支持分享大图卡片样式，自定义图片建议长宽比是 5:4。6.5.9及以上版本微信客户端小程序类型分享使用大图卡片样式。</p></li><li><p>支持分享开发版/体验版小程序，为支持开发者调试，开发者工具包支持分享开发版/体验版小程序至微信，开发者可控制分享的小程序版本。</p></li></ul><p>具体流程图如下：</p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/10/16482019ca1c16b9~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="app分享到小程序" tabindex="0" loading="lazy"><figcaption>app分享到小程序</figcaption></figure><h3 id="朋友圈打开小程序" tabindex="-1"><a class="header-anchor" href="#朋友圈打开小程序" aria-hidden="true">#</a> 朋友圈打开小程序</h3><p>在朋友圈中，发布图片附带小程序二维码，用户把图片分享到朋友圈中，看到的一方即可长恩识别在微信中打开小程序。<strong>通过这个玩法，实现了把小程序「分享」到朋友圈。</strong></p><p>至于图片的生成，canvas和服务器端生成都是比较成熟的解决方案。</p><h3 id="小程序支持打开app" tabindex="-1"><a class="header-anchor" href="#小程序支持打开app" aria-hidden="true">#</a> 小程序支持打开APP</h3><p>这个玩法有一个前提：小程序卡片必须是由APP分享出去，才可以打开APP</p><p>功能流程图如下：</p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/10/16482019ca2629ac~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="打开app" tabindex="0" loading="lazy"><figcaption>打开app</figcaption></figure><p>该途径可以作为小程序对于app的补充：<strong>产品可以通过 App 和小程序实现场景互补。</strong></p><p>比如用户 Sherry 将一个文档分享给用户 Kevin，Kevin 可以在小程序内直接查看。如果需要编辑，则可以直接打开 App 完成协同处理。这样一来，小程序不需要做的很重，只需满足基本功能，更多功能由 App 来补充。</p><p>case举例：用户代打车，用户A想让用户B代打车，用户A将行程分享给用户B，用户B微信打开小程序之后，跳转美团打车APP完成相关复杂操作。</p><h3 id="小程序向公众号导流" tabindex="-1"><a class="header-anchor" href="#小程序向公众号导流" aria-hidden="true">#</a> 小程序向公众号导流</h3><p>在小程序中，可以利用一些引导性文案指引用户点击进入客服会话页面，然后客服自动回复一条公众号图文消息，而图文消息则有引导关注公众号获取更多服务的指引文案。（<strong>经典用法，但是小心被封</strong>）</p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/10/16482019d13b8bef~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="客服会话" tabindex="0" loading="lazy"><figcaption>客服会话</figcaption></figure><h3 id="小程序和微信卡劵能力结合" tabindex="-1"><a class="header-anchor" href="#小程序和微信卡劵能力结合" aria-hidden="true">#</a> 小程序和微信卡劵能力结合</h3><p>比较小众的玩法：<strong>用户可以从小程序中快速领取会员卡和优惠券，也可以从卡包中的会员卡直达小程序。</strong></p><p>增加接入途径：从卡包直接进入（发卡需要注册并认证）</p><figure><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/7/10/16482019d1616505~tplv-t2oaga2asx-zoom-in-crop-mark:4536:0:0:0.awebp" alt="用户卡包" tabindex="0" loading="lazy"><figcaption>用户卡包</figcaption></figure><p>作者：大明<br> 链接：https://juejin.cn/post/6844903635772506119<br> 来源：稀土掘金<br> 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>`,55),i=[t];function o(c,r){return n(),e("div",null,i)}const u=a(p,[["render",o],["__file","小程序的页面分享.html.vue"]]);export{u as default};
